<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Sequence Alignment</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

    <link rel="stylesheet" href="static/style.css">
</head>
<body>
    <style>
        #result-container pre {
            padding-top: 10px;
            font-family: monospace;
        }
        .match { color: green; }
        .partial { color: darkorange; }
        .mismatch { color: maroon; }
        .gap { color: #333333; }
        .btn-group button {
            margin-right: 20px;
        }
    </style>

    <script type="module">
        import init, { smith_waterman_custom, smith_waterman_blosum62, needleman_wunsch_custom, needleman_wunsch_blosum62 } from './pkg/web_bio_tools.js';

        async function run() {
            await init();

            function parseFasta(text, defaultName) {
                const lines = text.trim().split(/\r?\n/).filter(l => l.trim() !== '');
                if (lines.length === 0) {
                    return { name: defaultName, sequence: '' };
                }
                if (lines[0].startsWith('>')) {
                    const name = lines[0].substring(1).trim() || defaultName;
                    const seq = lines.slice(1).join('').replace(/\s+/g, '');
                    return { name, sequence: seq };
                } else {
                    const seq = lines.join('').replace(/\s+/g, '');
                    return { name: defaultName, sequence: seq };
                }
            }

            function displayResult(result, algorithm) {
                document.getElementById('result-container').style.visibility = 'visible';

                const seq1 = result.aligned_seq1;
                const seq2 = result.aligned_seq2;
                const markup = result.alignment_markup;
                let final = '';
                let html1 = '';
                let htmlm = '';
                let html2 = '';
                let m = '';
                for (let i = 0; i < seq1.length; i++) {
                    const c1 = seq1[i];
                    const c2 = seq2[i];
                    const mark = markup[i];
                    let cls = 'match';
                    if (mark === ' ') {
                        cls = 'gap';
                        m = ' ';
                    } else if (mark === ':') {
                        cls = 'partial';
                        m = ':';
                    } else if (mark === '.') {
                        cls = 'mismatch';
                        m = 'X';
                    } else {
                        m = '|';
                    }
                    html1 += `<span class="${cls}">${c1}</span>`;
                    html2 += `<span class="${cls}">${c2}</span>`;
                    htmlm += m;
                    if (i % 80 === 79) {
                        final += html1 + '\n';
                        final += htmlm + '\n';
                        final += html2 + '\n';
                        final += '\n\n';
                        html1 = '';
                        htmlm = '';
                        html2 = '';
                    }
                }

                if (html1.length > 0) {
                    final += html1 + '\n';
                    final += htmlm + '\n';
                    final += html2 + '\n';
                }

                document.getElementById('result').innerHTML = final;

                document.getElementById('alignment-length').textContent = result.aligned_length;
                document.getElementById('alignment-score').textContent = (100 * result.aligned_identity).toFixed(2) + '%';
                document.getElementById('alignment-raw-score').textContent = result.score.toFixed(2);
                document.getElementById('alignment-mode').textContent = algorithm === 'nw' ? 'global' : 'local';
            }

            function formatDate(ts) {
                const d = new Date(ts);
                const months = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
                const day = d.getDate().toString().padStart(2, '0');
                const month = months[d.getMonth()];
                const year = d.getFullYear();
                const hours = d.getHours().toString().padStart(2, '0');
                const minutes = d.getMinutes().toString().padStart(2, '0');
                const seconds = d.getSeconds().toString().padStart(2, '0');
                return `${day} ${month} ${year} ${hours}:${minutes}:${seconds}`;
            }

            let rightbarShown = false;
            window.updateSavedAlignments = function() {
                const saved = JSON.parse(localStorage.getItem('savedAlignments') || '[]');
                const list = document.getElementById('saved-alignments');
                if (!list) return;
                list.innerHTML = '';
                saved.forEach((item, idx) => {
                    const li = document.createElement('li');
                    li.className = 'list-group-item p-1';
                    const a = document.createElement('a');
                    a.href = '#';
                    a.dataset.index = idx;
                    a.textContent = `${item.name1} vs ${item.name2}`;
                    a.addEventListener('click', (e) => {
                        e.preventDefault();
                        window.showSavedAlignment(idx);
                    });
                    const time = document.createElement('small');
                    time.className = 'text-muted ml-2';
                    time.textContent = formatDate(item.timestamp);
                    const share = document.createElement('button');
                    share.className = 'btn btn-link btn-sm float-right';
                    share.innerHTML = '<i class="fa fa-share"></i>';
                    share.addEventListener('click', (e) => {
                        e.preventDefault();
                        window.shareSavedAlignment(idx);
                    });
                    const del = document.createElement('button');
                    del.className = 'btn btn-link btn-sm text-danger float-right';
                    del.innerHTML = '&times;';
                    del.addEventListener('click', (e) => {
                        e.preventDefault();
                        window.deleteSavedAlignment(idx);
                    });
                    li.appendChild(a);
                    li.appendChild(time);
                    li.appendChild(share);
                    li.appendChild(del);
                    list.appendChild(li);
                });
                const rb = document.getElementById('rightbar');
                if (saved.length > 0) {
                    rb.style.display = 'block';
                    rightbarShown = true;
                } else if (!rightbarShown) {
                    rb.style.display = 'none';
                }
            }

            window.showUndo = function(msg, undoFn) {
                const cont = document.getElementById('undo-container');
                cont.innerHTML = `${msg} <a href="#" id="undo-link">Undo</a>`;
                cont.style.display = 'block';
                if (window.undoTimeout) clearTimeout(window.undoTimeout);
                document.getElementById('undo-link').addEventListener('click', (e) => {
                    e.preventDefault();
                    cont.style.display = 'none';
                    clearTimeout(window.undoTimeout);
                    undoFn();
                }, { once: true });
                window.undoTimeout = setTimeout(() => {
                    cont.style.display = 'none';
                }, 10000);
            }

            window.deleteSavedAlignment = function(idx) {
                const saved = JSON.parse(localStorage.getItem('savedAlignments') || '[]');
                const item = saved.splice(idx, 1)[0];
                localStorage.setItem('savedAlignments', JSON.stringify(saved));
                updateSavedAlignments();
                if (item) {
                    window.showUndo('Alignment deleted.', () => {
                        saved.splice(idx, 0, item);
                        localStorage.setItem('savedAlignments', JSON.stringify(saved));
                        updateSavedAlignments();
                    });
                }
            }

            window.clearSavedAlignments = function() {
                const saved = JSON.parse(localStorage.getItem('savedAlignments') || '[]');
                if (saved.length === 0) return;
                localStorage.removeItem('savedAlignments');
                updateSavedAlignments();
                window.showUndo('History cleared.', () => {
                    localStorage.setItem('savedAlignments', JSON.stringify(saved));
                    updateSavedAlignments();
                });
            }

            window.showSavedAlignment = function(idx) {
                const saved = JSON.parse(localStorage.getItem('savedAlignments') || '[]');
                const item = saved[idx];
                if (!item) return;
                document.getElementById('seq1').value = `>${item.name1}\n${item.seq1}`;
                document.getElementById('seq2').value = `>${item.name2}\n${item.seq2}`;
                displayResult(item.result, item.algorithm);
            }

            window.shareSavedAlignment = function(idx) {
                const saved = JSON.parse(localStorage.getItem('savedAlignments') || '[]');
                const item = saved[idx];
                if (!item) return;
                const url = new URL(window.location.href.split('?')[0]);
                url.searchParams.set('seq1', `>${item.name1}\n${item.seq1}`);
                url.searchParams.set('seq2', `>${item.name2}\n${item.seq2}`);
                url.searchParams.set('gap_open', item.gapOpen);
                url.searchParams.set('gap_extend', item.gapExtend);
                url.searchParams.set('weight', item.weightOption);
                if (item.weightOption === 'uniform') {
                    url.searchParams.set('match_score', item.matchScore);
                    url.searchParams.set('mismatch_penalty', item.mismatchPenalty);
                }
                url.searchParams.set('mode', item.algorithm);
                const shareUrl = url.toString();
                if (navigator.clipboard && navigator.clipboard.writeText) {
                    navigator.clipboard.writeText(shareUrl).then(() => {
                        alert('Share URL copied to clipboard.');
                    }, () => {
                        window.prompt('Share this URL', shareUrl);
                    });
                } else {
                    window.prompt('Share this URL', shareUrl);
                }
            }

            window.downloadAlignment = function() {
                if (!window.lastAlignment) return;
                const a = window.lastAlignment;
                const r = a.result;
                const seq1 = r.aligned_seq1;
                const seq2 = r.aligned_seq2;
                const markup = r.alignment_markup;
                let text = '';
                let l1 = '', l2 = '', lm = '';
                for (let i = 0; i < seq1.length; i++) {
                    let m = markup[i];
                    if (m === ' ') m = ' ';
                    else if (m === ':') m = ':';
                    else if (m === '.') m = 'X';
                    else m = '|';
                    l1 += seq1[i];
                    l2 += seq2[i];
                    lm += m;
                    if (i % 80 === 79) {
                        text += l1 + '\n' + lm + '\n' + l2 + '\n\n';
                        l1 = '';
                        lm = '';
                        l2 = '';
                    }
                }
                if (l1.length > 0) {
                    text += l1 + '\n' + lm + '\n' + l2 + '\n';
                }

                let content = 'Sequence Alignment\n';
                content += 'Time: ' + formatDate(a.timestamp) + '\n';
                content += 'Algorithm: ' + (a.algorithm === 'nw' ? 'global (Needleman-Wunsch)' : 'local (Smith-Waterman)') + '\n';
                content += 'Scoring matrix: ' + a.weightOption + '\n';
                if (a.weightOption === 'uniform') {
                    content += 'Match score: ' + a.matchScore + '\n';
                    content += 'Mismatch penalty: ' + a.mismatchPenalty + '\n';
                }
                content += 'Gap open: ' + a.gapOpen + '\n';
                content += 'Gap extend: ' + a.gapExtend + '\n';
                content += '\nInput sequence 1 (' + a.name1 + '):\n' + a.seq1 + '\n';
                content += '\nInput sequence 2 (' + a.name2 + '):\n' + a.seq2 + '\n';
                content += '\nAlignment length: ' + r.aligned_length + '\n';
                content += 'Identity: ' + (100 * r.aligned_identity).toFixed(2) + '%\n';
                content += 'Score: ' + r.score.toFixed(2) + '\n\n';
                content += text;
                content += '\nCreated using Web-Bio-Tools. See https://web-bio-tools.big-data-biology.org\n';

                const blob = new Blob([content], {type: 'text/plain'});
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = a.name1 + '_vs_' + a.name2 + '.txt';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
            }

            window.lastAlignment = null;
            window.updateSavedAlignments();

            const params = new URLSearchParams(window.location.search);
            const pSeq1 = params.get('seq1');
            const pSeq2 = params.get('seq2');
            if (pSeq1) document.getElementById('seq1').value = pSeq1;
            if (pSeq2) document.getElementById('seq2').value = pSeq2;
            if (params.has('gap_open')) {
                document.getElementById('gap-open').value = params.get('gap_open');
            }
            if (params.has('gap_extend')) {
                document.getElementById('gap-extend').value = params.get('gap_extend');
            }
            if (params.has('match_score')) {
                document.getElementById('match-score').value = params.get('match_score');
            }
            if (params.has('mismatch_penalty')) {
                document.getElementById('mismatch-penalty').value = params.get('mismatch_penalty');
            }
            if (params.has('weight')) {
                document.getElementById('weight-option').value = params.get('weight');
                $('#weight-option').trigger('change');
            }
            if (params.has('seq_type')) {
                document.getElementById('sequence-type').value = params.get('seq_type');
                $('#sequence-type').trigger('change');
            }

            window.alignSequences = (algorithm) => {
                const parsed1 = parseFasta(document.getElementById('seq1').value, 'sequence1');
                const parsed2 = parseFasta(document.getElementById('seq2').value, 'sequence2');
                const warningEl = document.getElementById('input-warning');
                if (parsed1.sequence === '' || parsed2.sequence === '') {
                    warningEl.textContent = 'Please enter sequences in both input fields before alignment. You can also load the example sequences.';
                    warningEl.style.display = 'block';
                    return;
                }
                warningEl.style.display = 'none';
                const seqType = document.getElementById('sequence-type').value;
                if (seqType === 'dna') {
                    $('#weight-option').val('uniform').trigger('change');
                } else if (/^[ATCG]+$/i.test(parsed1.sequence) && /^[ATCG]+$/i.test(parsed2.sequence)) {
                    warningEl.textContent = 'Your sequences look like DNA. Did you mean to use the DNA model?';
                    warningEl.style.display = 'block';
                }
                const gapOpen = parseFloat(document.getElementById('gap-open').value);
                const gapExtend = parseFloat(document.getElementById('gap-extend').value);
                if (gapExtend < gapOpen) {
                    warningEl.textContent = 'Gap extend penalty should be less than the gap open penalty.';
                    warningEl.style.display = 'block';
                }
                const weightOption = document.getElementById('weight-option').value;
                let result;
                if (algorithm === 'nw') {
                    if (weightOption === 'blosum62') {
                        result = needleman_wunsch_blosum62(parsed1.sequence, parsed2.sequence, gapOpen, gapExtend);
                    } else {
                        const matchScore = parseFloat(document.getElementById('match-score').value);
                        const mismatchPenalty = parseFloat(document.getElementById('mismatch-penalty').value);
                        result = needleman_wunsch_custom(parsed1.sequence, parsed2.sequence, matchScore, mismatchPenalty, gapOpen, gapExtend);
                    }
                } else {
                    if (weightOption === 'blosum62') {
                        result = smith_waterman_blosum62(parsed1.sequence, parsed2.sequence, gapOpen, gapExtend);
                    } else {
                        const matchScore = parseFloat(document.getElementById('match-score').value);
                        const mismatchPenalty = parseFloat(document.getElementById('mismatch-penalty').value);
                        result = smith_waterman_custom(parsed1.sequence, parsed2.sequence, matchScore, mismatchPenalty, gapOpen, gapExtend);
                    }
                }
                displayResult(result, algorithm);

                window.lastAlignment = {
                    name1: parsed1.name,
                    name2: parsed2.name,
                    seq1: parsed1.sequence,
                    seq2: parsed2.sequence,
                    algorithm,
                    weightOption,
                    matchScore: parseFloat(document.getElementById('match-score').value),
                    mismatchPenalty: parseFloat(document.getElementById('mismatch-penalty').value),
                    gapOpen,
                    gapExtend,
                    result,
                    timestamp: Date.now()
                };
            };

            const modeParam = params.get('mode');
            if (pSeq1 && pSeq2) {
                const mode = (modeParam === 'nw' || modeParam === 'global') ? 'nw' : 'sw';
                window.alignSequences(mode);
            }

        }

        run();
    </script>
    <script>
        $(function() {
            $('#sidebar-container').load('sidebar.html');
            const seq_example_similar_1 = ">SHD1_0881_ErmB\n" +
                "MNKNIKYSQNFLTSEKVLNQIIKQLNLKETDTVYEIGTGKGHLTTKLAKISKQVTSIELDSHLFNLSSEKLKLNTRVTLIHQDILQFQFPNKQRYKIVGSIPYHLSTQIIKKVVFESHASDIYLIVEEGFYKRTLDIHRTLGLLLHTQVSIQQLLKLPAECFHPKPKVNSVLIKLTRHTTDVPDKYWKLYTYFVSKWVNREYRQLFTKNQFHQAMKHAKVNNLSTVTYEQVLSIFNSYLLFNGRK";

            const seq_example_similar_2 = ">gb|AAF86219.1|+|ErmB [Enterococcus faecium]\n" +
                "MNKNIKYSQNFLTSEKVLNQIIKQLNLKETDTVYEIGTGKGHLTTKLAKISKQVTSIELDSHLFNLSSEKLKLNTRVTLIHQDILQFQFPNKQRYKIVGSIPYNLSTQIIKKVVFESRASDIYLIVEEGFYKRTLDIHRTLGLLLHTQVSIQQLLKLPAECFHPKPKVNSVLIKLTRHTTDVPDKYWKLYTYFVSKWVNREYRQLFTKNQFHQAMKHAKVNNLSTITYEQVLSIFNSYLLFNGRKLIL";

            const example_intermediate_1 = ">dldHA2X_1_AL939117_partial\n" +
                "MTFSSTSSAPPPSPLLPATRITVYGCGRDEAALFRRTAPRFGVEATLTEAAVSEENAEMAAGNQCISIDHKTPVTPATLRALHRAGVTYISTRSIGYNHIDVTYAAGVGISVENVTYSPAGVADYTLMLMLMAVRNAKSTVRRAELHDYRLNEIRGKELRDLTVGVIGTGRIGAAVVDRLRGFGSRVLAYGKRPTIAADYVSLDELLRSSDIVSLHVPLTPDTHHLLDQSRIRRMKSGAFVINTGRGPLIDTEALVPALESGRLSGAALDVIEGEEGIFYADCRNRTIESTWLPRLQKMPNVLISPHTAYYTDHALMDTVENSIINCLNFGSRKQHGVGQVGQVEGRHRIRGLFRRTRRFRQVRPGGRTQPRHREVPAVLRGDHEGRRLETLRRARPGLGERRLPS";

            const example_intermediate_2 = ">gnl|BL_ORD_ID|759|hsp_num:0\n" +
                "MSYRDLGLIDSEVIAERRVRALDDSSPSAVPTTGVRVFGCGHDEAVLFREMGTRLGITPSITEEAISETNAELARGNRCISVSHKTQIDNSTLLALSRVGVEYISTRSVGYNHIDVEFAASIGISVGNVDYSPDSVGDYTLMLMLMTVRHAKSIVRRADTHDYRLNDTRGRELRDLTVGVIGTGRIGTAVIDRLQGFGCRVLAHDSGPHASADYVPLDELLRQSDIVTLHTPLTADTHHLLDRQRIDQMKHGAYIVNTGRGPLLDTEALLSALESGRLGGAALDVVEGEEGIFYADCRNRLIENKALVRLQRLPNVLISPHSAYYTDHALNDTVENSLVNCLNFESGRTA";

            const seq_example_different_1 = ">ERMA_STAAU\n" +
                "MNQKNPKDTQNFITSKKHVKEILNHTNISKQDNVIEIGSGKGHFTKELVKMSRSVTAIEIDGGLCQVTKEAVNPSENIKVIQTDILKFSFPKHINYKIYGNIPYNISTDIVKRITFESQAKYSYLIVEKGFAKRLQNLQRALGLLLMVEMDIKMLKKVPPLYFHPKPSVDSVLIVLERHQPLISKKDYKKYRSFVYKWVNREYRVLFTKNQFRQALKHANVTNINKLSKEQFLSIFNSYKLFH";
            const seq_example_different_2 = ">ERMA_AERER\n" +
                "MAGPQDRPRGRGPSSGRPQRPVGGRSQRDRDRRVLGQNFLRDPATIRRIADAADVDPDGLVVEAGPGEGLLTRELARRAGRVRTYELDQRLARRLSTDLAQETSIEVVHADFLTAPHPEEPFQFVGAIPYGITSAIVDWCLTAPTLTSATLVTQQEFARKRTGDYGRWTALTVTTWPTFEWQYVAKVDRTLFTPVPRVHSAIMRLRRRPQPLLRDAAARSRFADMVEIGFVGKGGSLYRSLTREWPRSKVDSAFARADVHHDEIVAFVHPDQWITLFQLLDGSRGGAARGPGDQRGRRGRPGGGPRPDGRAGGGPRRDAGGRRTGDGRGGRPRPPRGGQA";

            $('#load-example-similar').on('click', function(e) {
                e.preventDefault();
                $('#seq1').val(seq_example_similar_1);
                $('#seq2').val(seq_example_similar_2);
            });
            $('#load-example-intermediate').on('click', function(e) {
                e.preventDefault();
                $('#seq1').val(example_intermediate_1);
                $('#seq2').val(example_intermediate_2);
            });
            $('#load-example-different').on('click', function(e) {
                e.preventDefault();
                $('#seq1').val(seq_example_different_1);
                $('#seq2').val(seq_example_different_2);
            });
            $('#toggle-advanced').on('click', function(e) {
                e.preventDefault();
                $('#advanced-params').toggle();
                $(this).text(function(_, txt) {
                    return txt === 'Show advanced parameters' ? 'Hide advanced parameters' : 'Show advanced parameters';
                });
            });
            $('#sequence-type').on('change', function() {
                if (this.value === 'dna') {
                    $('#weight-option').val('uniform').trigger('change');
                }
            });
            $('#weight-option').on('change', function() {
                if (this.value === 'uniform') {
                    $('#uniform-params').addClass('show');
                } else {
                    $('#uniform-params').removeClass('show');
                }
            }).trigger('change');
            $('#save-alignment').on('click', function(e) {
                e.preventDefault();
                if (!window.lastAlignment) return;
                const saved = JSON.parse(localStorage.getItem('savedAlignments') || '[]');
                saved.unshift(window.lastAlignment);
                localStorage.setItem('savedAlignments', JSON.stringify(saved));
                updateSavedAlignments();
            });
            $('#download-alignment').on('click', function(e) {
                e.preventDefault();
                window.downloadAlignment();
            });
            $('#clear-history').on('click', function(e) {
                e.preventDefault();
                window.clearSavedAlignments();
            });
        });
    </script>

    <div class="container-fluid">
        <div class="row">
            <div class="col-md-2" id="sidebar-container"></div>
            <div class="col">
                <h1>Web Bio Tools</h1>
                <h2>Sequence Alignment</h2>
                <textarea id="seq1" placeholder="Enter first sequence (FASTA or raw)" rows=20 cols=40></textarea>
                <textarea id="seq2" placeholder="Enter second sequence (FASTA or raw)" rows=20 cols=40></textarea>
                <p>
                    Load examples:
                    <a href="#" id="load-example-similar">very similar sequences</a> |
                    <a href="#" id="load-example-intermediate">somewhat divergent sequences</a> |
                    <a href="#" id="load-example-different">very different sequences</a>
                </p>
                <p>
                    <label>Sequence type: <select id="sequence-type">
                        <option value="protein" selected>Protein</option>
                        <option value="dna">DNA</option>
                    </select></label>
                </p>
                <p><a href="#" id="toggle-advanced">Show advanced parameters</a></p>
                <div id="advanced-params" style="display:none;">
                    <label>Scoring matrix:
                        <select id="weight-option">
                            <option value="uniform">Uniform</option>
                            <option value="blosum62" selected>BLOSUM62</option>
                        </select>
                    </label><br>
                    <div id="uniform-params">
                        <label>Match score: <input type="number" id="match-score" value="2"></label><br>
                        <label>Mismatch penalty: <input type="number" id="mismatch-penalty" value="-1"></label><br>
                    </div>
                    <label>Gap open penalty: <input type="number" id="gap-open" value="-10"></label><br>
                    <label>Gap extend penalty: <input type="number" id="gap-extend" value="-0.5"></label>
                </div>
                <div id="input-warning" class="alert alert-warning mt-2" style="display:none"></div>
                <div class="btn-group" role="group">
                    <button class="btn btn-primary" onclick="alignSequences('sw')">Local Alignment</button>
                    <button class="btn btn-primary" onclick="alignSequences('nw')">Global Alignment</button>
                </div>
                <div id="result-container"
                     style="visibility: hidden;">
                    <h3>Alignment result (<span id="alignment-mode"></span>)</h3>
                    <p>Alignment length: <span id="alignment-length"></span> (<span id="alignment-score"></span> identity, score <span id="alignment-raw-score"></span>)</p>
                    <button id="save-alignment" class="btn btn-secondary btn-sm mb-2">Save Alignment</button>
                    <button id="download-alignment" class="btn btn-secondary btn-sm mb-2">Download Alignment</button>
                    <pre id="result"></pre>
                </div>

                <p>
                    This site provides simple bioinformatics tools compiled to WebAssembly
                    with Rust. It can perform local or global sequence alignment
                    directly in your browser.
                </p>
                <p>
                    Source code available on <a href="https://github.com/luispedro/web-bio-tools">GitHub</a>.<br>
                    Author: <a href="https://luispedro.org">Luis Pedro Coelho</a>
                </p>
            </div>
            <div class="col-md-3">
                <nav id="rightbar" style="display:none;">
                    <div>
                        <h6>Saved Alignments</h6>
                        <p class="small text-muted mb-1">Saved only in your browser's local storage.</p>
                        <button id="clear-history" class="btn btn-secondary btn-sm mb-2">Clear History</button>
                        <div id="undo-container" class="alert alert-info p-1" style="display:none"></div>
                        <ul id="saved-alignments" class="list-group mb-2"></ul>
                    </div>
                </nav>
            </div>
        </div>
    </div>
</body>
</html>
